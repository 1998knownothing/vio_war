<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <title>BUI示例</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/buijs/lib/latest/bui.css">
    <script src="https://cdn.jsdelivr.net/npm/buijs/lib/zepto.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/buijs/lib/latest/bui.js"></script>
    <style></style>
</head>
<body>
<style>
    .page-form .bui-fluid-space-3 .span1 {
        margin-bottom: .2rem;
    }
    .selected-val {
        margin-right: .1rem;
    }
</style>
<div class="bui-page page-form">
    <header class="bui-bar">
        <div class="bui-bar-left"> 	<a class="bui-btn" onclick="bui.back();"><i class="icon-back"></i></a> </div>
        <div class="bui-bar-main">招聘信息发布表单</div>
        <div class="bui-bar-right"> </div>
    </header>
    <main>
        <h3 class="section-title">基本信息</h3>
        <ul class="bui-list">
            <li class="bui-btn bui-box clearactive">
                <label class="bui-label" for="company">公司名称:</label>
                <div class="span1">
                    <div class="bui-input user-input">
                        <input id="company" type="text" value="" placeholder="请输入公司名称" maxlength="16"> </div>
                </div>
            </li>
            <li class="bui-btn bui-box clearactive">
                <label class="bui-label" for="positionName">职位名称:</label>
                <div class="span1">
                    <div class="bui-input user-input">
                        <input id="positionName" type="text" value="" placeholder="请输入职位名称" maxlength="16"> </div>
                </div>
            </li>
            <li class="bui-list">
            <li class="bui-btn bui-box">
                <label class="bui-label">职位类型</label>
                <div class="span1"> </div>
                <div id="selectPosition" class="bui-select">请选择 </div> <i class="icon-listright"></i> </li>


            </li>

        </ul>



        <ul class="bui-list">
            <li class="bui-btn bui-box">
                <label class="bui-label">所在城市</label>
                <div class="span1"> </div>
                <div id="selectCity" class="bui-select">请选择 </div> <i class="icon-listright"></i> </li>
        </ul>

        <ul class="bui-list">
            <li class="bui-btn bui-box">
                <label class="bui-label">实习周期</label>
                <div class="span1"> </div>
                <div id="selectPeriod" class="bui-select">请选择 </div> <i class="icon-listright"></i> </li>
        </ul>

        <ul id="selectLine" class="bui-list">
            <li class="bui-btn bui-box">
                <label class="bui-label">尽快入职</label>
                <div class="span1"></div>
                <div class="bui-value">
                    <input type="checkbox" class="bui-switch-text" value="0" uncheck="ON" check="OFF" checked="checked" id="isQuick"> </div>
            </li>
        </ul>

        <li class="bui-btn bui-box clearactive">
            <label class="bui-label" for="positionName">投递邮箱</label>
            <div class="span1">
                <div class="bui-input user-input">
                    <input id="contact" type="text" value="" placeholder="请输入邮箱地址"> </div>
            </div>
        </li>

        <li class="bui-btn bui-box clearactive">
            <label class="bui-label" for="positionName">简历命名</label>
            <div class="span1">
                <div class="bui-input user-input">
                    <input id="resumeFormat" type="text" value="" placeholder="请输入工作具体地址"> </div>
            </div>
        </li>

        <li class="bui-btn bui-box clearactive">
            <label class="bui-label" for="positionName">工作地址</label>
            <div class="span1">
                <div class="bui-input user-input">
                    <input id="address" type="text" value="" placeholder="请输入工作具体地址"> </div>
            </div>
        </li>

        <h3 class="section-title">职位描述</h3>
        <ul class="bui-list">
            <li class="bui-btn clearactive">
                <div class="bui-input">
                    <textarea class="bui-input" cols="30" rows="4" placeholder="请输入内容" id="commentContent" ></textarea>
                </div>
            </li>
        </ul>

        <div class="section-title">公司logo上传: </div>
        <div id="logo" class="bui-upload bui-fluid-space-4">
            <div class="span1">
                <input id="pic" type="file" name="uploadFile" />
                <div class="bui-btn"> <i class="icon-plus large"></i> </div>
            </div>
        </div>
        <div class="container-y">
            <div class="bui-box-space">
                <div class="span1">
                    <div class="bui-btn round primary" id="sub">提交</div>
                    <div class="bui-btn round primary" id="btnSend">提交</div>
                </div>
            </div>
        </div>
    </main>
</div>

<script>/**
 * 表单模板
 * 默认模块名: pages/form/form
 * @return {[object]}  [ 返回一个对象 ]
 */
bui.ready(function(){

    $("#sub").on("click", function() {
        var company=$("#company").val();
        var positionName=$("#positionName").val();
        var contact=$("#contact").val();
        var resumeFormat=$("#resumeFormat").val();
        var address=$("#address").val();
        var positionDesc=$("#commentContent").val();
        var city=uiCity.text();
        var position =uiPosition.text();
        var period=uiPeriod.text();
        var isQuick=$('input[id="isQuick"]:checked').val();
        if(isQuick!=0)isQuick=1;

        var formData=new FormData();
        var img=$('#pic').get(0).files[0];

        formData.append('logo',img);
        formData.append('company',company);
        formData.append('city',city);

        $.ajax({
            type: 'POST',
            url: 'http://localhost:8080/vio_war/employment/addemp',
            // data to be added to query string:
            data:formData,
            contentType:"multipart/form-data",
            // type of data we are expecting in return:
            success: function(data){
             alert(data.code)
            },
            error: function(xhr, type){
                alert('Ajax error!')
            }
        })
    })




    // 手机号,帐号是同个样式名, 获取值的时候,取的是最后一个focus的值
    var userInput = bui.input({
        id: ".user-input",
        callback: function(e) {
            // 清空数据
            this.empty();
        }
    })

    // 验证码示例
    var $btnSend = $("#btnSend");


    $btnSend.on("click", function(argument) {
        var company=$("#company").val();
        var positionName=$("#positionName").val();
        var contact=$("#contact").val();
        var resumeFormat=$("#resumeFormat").val();
        var address=$("#address").val();
        var positionDesc=$("#commentContent").val();
        var city=uiCity.text();
        var position =uiPosition.text();
        var period=uiPeriod.text();
        var isQuick=$('input[id="isQuick"]:checked').val();
        if(isQuick!=0)isQuick=1;


        uiUpload.start({
            // url: "http://eid.bingosoft.net:83/share/apis/upload/image",
            url:"http://localhost:8080/vio_war/employment/addemp",
            // url: "https://www.swla.com.cn/demo/upload.asp",
            // url:"http://10.201.78.23:81/dataservice.ashx?CommandName=Atd$ImgUpLoad",
            method:"POST",
         //   fileKey:"logo",
            data: {
                "company":company,
                "positionName":positionName,
                "contact":contact,
                "resumeFormat":resumeFormat,
                "workAddr":address,
                "city":city,
                "position":position,
                "period":period,
                "isQuick":isQuick,
                "positionDesc":positionDesc,
            },
            onSuccess: function(data) {
                alert(data.code)
                //显示上传以后的图片
                //清空已经选择的图片
            },
            onFail: function(data) {
                alert(data.code)
            }
        })


        var hasDisabled = $(this).hasClass("disabled");
        if (!hasDisabled) {
            $(this).addClass("disabled")
            bui.hint("已提交")
        }
    })


    //动态绑定
    var uiCity = bui.select({
        trigger: "#selectCity",
        title: "请选择公司所在城市",
        type: "radio",
        data: [{
            "name": "北京",
            "value": "北京"
        }, {
            "name": "上海",
            "value": "上海"
        }, {
            "name": "广州",
            "value": "广州"
        }, {
            "name": "深圳",
            "value": "深圳"
        }, {
            "name": "杭州",
            "value": "杭州"
        }, {
            "name": "其他",
            "value": "其他"
        }]

    });

    //动态绑定
    var uiPosition = bui.select({
        trigger: "#selectPosition",
        title: "请选择职位类型",
        type: "radio",
        data: [{
            "name": "市场",
            "value": "市场"
        }, {
            "name": "运营",
            "value": "运营"
        }, {
            "name": "产品",
            "value": "产品"
        }, {
            "name": "设计",
            "value": "设计"
        }, {
            "name": "技术",
            "value": "技术"
        }, {
            "name": "其他",
            "value": "其他"
        }]

    });

    //动态绑定
    var uiPeriod = bui.select({
        trigger: "#selectPeriod",
        title: "请选择实习周期",
        type: "radio",
        data: [{
            "name": "一个月",
            "value": "一个月"
        }, {
            "name": "三个月",
            "value": "三个月"
        }, {
            "name": "六个月",
            "value": "六个月"
        }, {
            "name": "联系详谈实习周期",
            "value": "联系详谈实习周期"
        }]

    });

    uiPeriod.on("change", function() {
        //var val = uiSelect3.text();

        // alert(val);
    })


    var citySelect = null;


    $("#chooseCity").on("click", function() {
        citySelect.show();
    })



    // 评论字数
    var comment = bui.input({
        id: "#commentContent",
        showLength: true,
        showIcon: false,
        maxLength: 400
    })

    //
    // 拍照上传
    var $facePhoto = $("#logo");
    var uiUpload = bui.upload();

    $(".bui-upload .bui-btn").on("click", function() {

        uiUpload.add({
            "from": "camera",
            "onSuccess": function(val, data) {
                // $output.text(val);
                // 展示本地图片
                this.toBase64({
                    onSuccess: function(url) {
                        $facePhoto.prepend(templatePhoto(url))

                    }
                });

                // 也可以直接调用start上传图片
            }
        })

    })

    function templatePhoto(url) {
        return `<div class="span1">
                 <div class="bui-upload-thumbnail"><img src="${url}" alt="" /></div>
             </div>`
    }


    // 修复ios 光标跟着一起滚动问题
    if (bui.platform.isIos()) {
        $("main").on("scroll", function() {
            $('input').toggleClass('focus-fixed');
        })
    }
})

</script>
</body>
</html>